"use strict";angular.module("personalizerApp",["ngResource"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/tab/:service",{templateUrl:"views/onglet.html",controller:"OngletCtrl"}).when("/tab/:service/:zone",{templateUrl:"views/zone.html",controller:"ZoneCtrl"}).when("/tab/:service/:zone/add/:callID",{templateUrl:"views/add.html",controller:"AddCtrl"}).when("/tab/:service/:zone/edit/:callID",{templateUrl:"views/edit.html",controller:"EditCtrl"}).when("/error",{templateUrl:"views/error.html",controller:"MainCtrl"}).otherwise({redirectTo:"/error"})}]),angular.module("personalizerApp").controller("MainCtrl",["$rootScope","$scope","Manager",function(e,t,n){e.services=[],e.tabs=[],e.dbName=null,t.initPersonalizer=function(){n.initDB().then(function(){n.initPersonalizer().then(function(t){e.services=t.services,console.log(e.services);for(var n in e.services)e.tabs.push(n);t.dbName&&(e.dbName=t.dbName)},function(){window.alert("initialisation du personalizer failed")})},function(){window.alert("l'initialisation de la base a échoué !")})},t.start=function(){t.initPersonalizer()},t.start()}]),angular.module("personalizerApp").controller("OngletCtrl",["$rootScope","$scope","$routeParams",function(e,t,n){void 0===e.services&&(window.location.href="#/"),t.tab=n.service,t.service=e.services[t.tab],t.zones=[],t.numberCalls=0,t.setZone=function(e){window.location.href="#/tab/"+t.tab+"/"+e},t.getZones=function(){for(var e=0;t.service.length>e;e++){var n=t.service[e];t.zones.push(n.zone)}},t.getNumberOfCalls=function(e){for(var t=0,n=0;e.length>n;n++)for(var a=e[n],r=0;a.calls.length>r;r++)a.calls[r].params&&(t+=a.calls[r].params.length);return t},t.startTab=function(){t.getZones(),t.numberCalls=t.getNumberOfCalls(t.service)},t.startTab()}]),angular.module("personalizerApp").controller("StartCtrl",["$scope",function(e){e.openMain=function(){window.location.href="#/perso"}}]),angular.module("personalizerApp").factory("PersoConstants",function(){return{DOMAIN_URL:"http://"+document.location.hostname,PORT:"8080",PATH:document.location.pathname+"rest",PERSO_DOMAIN_URL:"http://"+document.location.hostname,PERSO_PORT:document.location.port,PERSO_PATH:document.location.pathname+"resources",PERSO_FILENAME:"personalizer.json"}}),angular.module("personalizerApp").factory("mongoService",["$http","PersoConstants",function(e,t){return{getCallIDZoneSource:function(n,a){return e.get(t.DOMAIN_URL+":"+t.PORT+t.PATH+"/source/"+n+"/zone/"+a+"/").then(function(e){return e.data})},getCallsCallID:function(n){return e.get(t.DOMAIN_URL+":"+t.PORT+t.PATH+"/call/callID/"+n+"/").then(function(e){return e.data})},getIdentifiedCall:function(n){return e.get(t.DOMAIN_URL+":"+t.PORT+t.PATH+"/call/"+n+"/").then(function(e){return e.data})},addCall:function(n,a){return e.post(t.DOMAIN_URL+":"+t.PORT+t.PATH+"/add/"+n+"/",a).then(function(e){return e.data})},deleteCall:function(n){return e.delete(t.DOMAIN_URL+":"+t.PORT+t.PATH+"/call/delete/"+n+"/").then(function(e){return e.data})},updateCall:function(n,a){return e.post(t.DOMAIN_URL+":"+t.PORT+t.PATH+"/call/edit/"+n+"/",a).then(function(e){return e.data})}}}]),angular.module("personalizerApp").factory("Manager",["PersoConstants","$http",function(e,t){return{initDB:function(){return t.get(e.DOMAIN_URL+":"+e.PORT+e.PATH).then(function(e){return e.data})},initPersonalizer:function(){return t.get(e.PERSO_DOMAIN_URL+":"+e.PERSO_PORT+e.PERSO_PATH+"/"+e.PERSO_FILENAME).then(function(e){return e.data})}}}]),angular.module("personalizerApp").factory("Manager",["PersoConstants","$http",function(e,t){return{initDB:function(){return t.get(e.DOMAIN_URL+":"+e.PORT+e.PATH).then(function(e){return e.data})},initPersonalizer:function(){return t.get(e.PERSO_DOMAIN_URL+":"+e.PERSO_PORT+e.PERSO_PATH+"/"+e.PERSO_FILENAME).then(function(e){return e.data})}}}]),angular.module("personalizerApp").controller("ZoneCtrl",["$rootScope","$scope","$routeParams","mongoService",function(e,t,n,a){void 0===e.services&&(window.location.href="#/"),t.tab=n.service,t.zone=n.zone,t.service=e.services[t.tab],t.callIDList=[],e.calls=[],t.getCallsOfZone=function(){a.getCallIDZoneSource(t.tab,t.zone).then(function(e){t.callIDList=e,t.getCallsFromCallID(t.callIDList)},function(){window.alert("get callID de la zone"+t.zone+" a échoué")})},t.getCallsFromCallID=function(t){for(var n=function(){a.getCallsCallID(o).then(function(t){e.calls[o]=t},function(){window.alert("suppression appel echoué")})},r=0;t.length>r;r++){var o=t[r];n()}},t.addNewCall=function(e){void 0!==e&&(window.location.href="#/tab/"+t.tab+"/"+t.zone+"/add/"+e)},t.editCall=function(e){void 0!==e&&(window.location.href="#/tab/"+t.tab+"/"+t.zone+"/edit/"+e)},t.removeCall=function(e){void 0!==e&&a.deleteCall(e).then(function(){window.alert(" appel supprimé !"),window.location.href="#/tab/"+t.tab+"/"+t.zone},function(){window.alert("suppression appel echoué")})},t.getOtherZones=function(){for(var e=[],n=0;t.service.length>n;n++){var a=t.service[n];a.zone!==t.zone&&e.push(a.zone)}return e},t.hasOtherZone=function(){return t.getOtherZones().length>0},t.changeZone=function(e){console.log(e),e&&(window.location.href="#/tab/"+t.tab+"/"+e)},t.startZone=function(){e.calls=t.getCallsOfZone()},t.startZone()}]),angular.module("personalizerApp").directive("tabs",function(){return{templateUrl:"views/tabs.html",restrict:"E",controller:["$scope",function(e){e.isActive=function(t){return e.tab?e.tab===t?"active":"":void 0}}]}}),angular.module("personalizerApp").controller("AddCtrl",["$rootScope","$scope","$routeParams","mongoService",function(e,t,n,a){void 0===e.services&&(window.location.href="#/"),t.tab=n.service,t.zone=n.zone,t.service=e.services[t.tab],t.callID=n.callID,t.parameters={},t.values=[],t.getParams=function(e){for(var n={},a=0;t.service.length>a;a++){var r=t.service[a];if(r.zone===t.zone)for(var o=r.calls,l=0;o.length>l;l++){var i=o[l];i.callID===e&&(n=i)}}return console.log(n),n},t.initValues=function(e){for(var n=[],a=0;e.length>a;a++)n[e[a].id]="";t.values=n},t.getParamProperties=function(e){var n=t.parameters.params,a={};if(n)for(var r=0;n.length>r;r++){var o=n[r];o.id===e&&(a=o)}return a},t.setOption=function(e,n){if(n)for(var a in t.values)a===e&&(t.values[e]=n)},t.validate=function(){console.log(t.values);var e=t.buildCall(t.values);a.addCall(t.callID,e).then(function(){window.alert("appel ajouté"),window.location.href="#/tab/"+t.tab+"/"+t.zone},function(){window.alert("ajout appel echoué")})},t.cancel=function(){var e=window.confirm("Êtes vous sûr de vouloir annuler l'ajout d'un nouveau appel ?");e&&(window.location.href="#/tab/"+t.tab+"/"+t.zone+"/")},t.getPathParams=function(){var e="";if(t.parameters.pathParams){var n=t.parameters.pathParams;if(n.length>0){var a="";t.parameters.pathPrefix&&(a+=t.parameters.pathPrefix);for(var r=0;n.length>r;r++)a+=n[r]+"/";e=a}else t.parameters.pathPrefix&&(e+=t.parameters.pathPrefix)}return e},t.getQueryParams=function(e){var n=[];if(t.parameters.queryParams){var a=t.parameters.queryParams;if(a.length>0)for(var r=0;a.length>r;r++){var o=a[r],l=t.getParamProperties(o);if(e[o]){var i=l.nameInDB,s=e[o];n.push({name:i,value:s})}}}return n},t.getHeaderParams=function(e){var n=[];if(t.parameters.headerParams){var a=t.parameters.headerParams;if(a.length>0)for(var r=0;a.length>r;r++){var o=a[r],l=t.getParamProperties(o);if(e[o]){var i=l.nameInDB,s=e[o];n.push({name:i,value:s})}}}return n},t.buildCall=function(e){var n={path:"",query:{},header:{},method:""};return n.path=t.getPathParams(),t.parameters.method&&(n.method=t.parameters.method),n.query=t.getQueryParams(e),n.header=t.getHeaderParams(e),n},t.startAdd=function(){t.parameters=t.getParams(t.callID),t.initValues(t.parameters.params)},t.startAdd()}]),angular.module("personalizerApp").controller("EditCtrl",["$rootScope","$scope","$routeParams","mongoService",function(e,t,n,a){void 0===e.services&&(window.location.href="#/"),t.tab=n.service,t.zone=n.zone,t.service=e.services[t.tab],t.callID=n.callID,t.params=[],t.values=[],t.getParams=function(e){for(var n=[],a=0;t.service.length>a;a++){var r=t.service[a];if(r.zone===t.zone)for(var o=r.calls,l=0;o.length>l;l++){var i=o[l];i.callID===e&&(n=i.params)}}return n},t.validate=function(){console.log(t.values);var e="";a.updateCall(e,t.values).then(function(){window.alert("appel modifié avec succés"),window.location.href="#/tab/"+t.tab+"/"+t.zone},function(){window.alert("la modification de l'appel a echoué")})},t.cancel=function(){var e=window.confirm("Êtes vous sûr de vouloir annuler la modification de l'appel ?");e&&(window.location.href="#/tab/"+t.tab+"/"+t.zone+"/")},t.initValues=function(e){for(var n=[],a=0;e.length>a;a++)n[e[a].id]=e[a].humanName;t.values=n},t.setOption=function(e,n){if(n)for(var a in t.values)a===e&&(t.values[e]=n)},t.startEdit=function(){t.params=t.getParams(t.callID),t.initValues(t.params)},t.startEdit()}]);