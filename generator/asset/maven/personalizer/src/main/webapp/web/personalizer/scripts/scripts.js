"use strict";angular.module("personalizerApp",["ngResource"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/tab/:service",{templateUrl:"views/onglet.html",controller:"OngletCtrl"}).when("/tab/:service/:zone",{templateUrl:"views/zone.html",controller:"ZoneCtrl"}).when("/tab/:service/:zone/add/:callID",{templateUrl:"views/add.html",controller:"AddCtrl"}).when("/tab/:service/:zone/edit/:callID",{templateUrl:"views/edit.html",controller:"EditCtrl"}).when("/error",{templateUrl:"views/error.html",controller:"MainCtrl"}).otherwise({redirectTo:"/error"})}]),angular.module("personalizerApp").controller("AddCtrl",["$rootScope","$scope","$routeParams","mongoService",function(e,t,a,n){void 0===e.services&&(window.location.href="#/"),t.tab=a.service,t.zone=a.zone,t.service=e.services[t.tab],t.callID=a.callID,t.parameters={},t.values=[],t.getParams=function(e){for(var a={},n=0;t.service.length>n;n++){var r=t.service[n];if(r.zone===t.zone)for(var o=r.calls,l=0;o.length>l;l++){var i=o[l];i.callID===e&&(a=i)}}return console.log(a),a},t.initValues=function(e){for(var a=[],n=0;e.length>n;n++)a[e[n].id]="";t.values=a},t.getParamProperties=function(e){var a=t.parameters.params,n={};if(a)for(var r=0;a.length>r;r++){var o=a[r];o.id===e&&(n=o)}return n},t.setOption=function(e,a){if(a)for(var n in t.values)n===e&&(t.values[e]=a)},t.validate=function(){console.log(t.values);var e=t.buildCall(t.values);n.addCall(t.callID,e).then(function(){window.alert("appel ajouté"),window.location.href="#/tab/"+t.tab+"/"+t.zone},function(){window.alert("ajout appel echoué")})},t.cancel=function(){var e=window.confirm("Êtes vous sûr de vouloir annuler l'ajout d'un nouveau appel ?");e&&(window.location.href="#/tab/"+t.tab+"/"+t.zone+"/")},t.getPathParams=function(){var e="";if(t.parameters.pathParams){var a=t.parameters.pathParams;if(a.length>0){var n="";t.parameters.pathPrefix&&(n+=t.parameters.pathPrefix);for(var r=0;a.length>r;r++)n+=a[r]+"/";e=n}else t.parameters.pathPrefix&&(e+=t.parameters.pathPrefix)}return e},t.getQueryParams=function(e){var a=[];if(t.parameters.queryParams){var n=t.parameters.queryParams;if(n.length>0)for(var r=0;n.length>r;r++){var o=n[r],l=t.getParamProperties(o);if(e[o]){var i=l.nameInDB,s=e[o];a.push({name:i,value:s})}}}return a},t.getHeaderParams=function(e){var a=[];if(t.parameters.headerParams){var n=t.parameters.headerParams;if(n.length>0)for(var r=0;n.length>r;r++){var o=n[r],l=t.getParamProperties(o);if(e[o]){var i=l.nameInDB,s=e[o];a.push({name:i,value:s})}}}return a},t.buildCall=function(e){var a={path:"",query:{},header:{},method:""};return a.path=t.getPathParams(),t.parameters.method&&(a.method=t.parameters.method),a.query=t.getQueryParams(e),a.header=t.getHeaderParams(e),a},t.startAdd=function(){t.parameters=t.getParams(t.callID),t.initValues(t.parameters.params)},t.startAdd()}]),angular.module("personalizerApp").controller("EditCtrl",["$rootScope","$scope","$routeParams","mongoService",function(e,t,a,n){void 0===e.services&&(window.location.href="#/"),t.tab=a.service,t.zone=a.zone,t.service=e.services[t.tab],t.callID=a.callID,t.params=[],t.values=[],t.getParams=function(e){for(var a=[],n=0;t.service.length>n;n++){var r=t.service[n];if(r.zone===t.zone)for(var o=r.calls,l=0;o.length>l;l++){var i=o[l];i.callID===e&&(a=i.params)}}return a},t.validate=function(){console.log(t.values);var e="";n.updateCall(e,t.values).then(function(){window.alert("appel modifié avec succés"),window.location.href="#/tab/"+t.tab+"/"+t.zone},function(){window.alert("la modification de l'appel a echoué")})},t.cancel=function(){var e=window.confirm("Êtes vous sûr de vouloir annuler la modification de l'appel ?");e&&(window.location.href="#/tab/"+t.tab+"/"+t.zone+"/")},t.initValues=function(e){for(var a=[],n=0;e.length>n;n++)a[e[n].id]=e[n].humanName;t.values=a},t.setOption=function(e,a){if(a)for(var n in t.values)n===e&&(t.values[e]=a)},t.startEdit=function(){t.params=t.getParams(t.callID),t.initValues(t.params)},t.startEdit()}]),angular.module("personalizerApp").controller("MainCtrl",["$rootScope","$scope","Manager",function(e,t,a){e.services=[],e.tabs=[],e.dbName=null,t.initPersonalizer=function(){a.initDB().then(function(){a.initPersonalizer().then(function(t){e.services=t.services,console.log(e.services);for(var a in e.services)e.tabs.push(a);t.dbName&&(e.dbName=t.dbName)},function(){window.alert("initialisation du personalizer failed")})},function(){window.alert("l'initialisation de la base a échoué !")})},t.start=function(){t.initPersonalizer()},t.start()}]),angular.module("personalizerApp").controller("OngletCtrl",["$rootScope","$scope","$routeParams",function(e,t,a){void 0===e.services&&(window.location.href="#/"),t.tab=a.service,t.service=e.services[t.tab],t.zones=[],t.numberCalls=0,t.setZone=function(e){window.location.href="#/tab/"+t.tab+"/"+e},t.getZones=function(){for(var e=0;t.service.length>e;e++){var a=t.service[e];t.zones.push(a.zone)}},t.getNumberOfCalls=function(e){for(var t=0,a=0;e.length>a;a++)for(var n=e[a],r=0;n.calls.length>r;r++)n.calls[r].params&&(t+=n.calls[r].params.length);return t},t.startTab=function(){t.getZones(),t.numberCalls=t.getNumberOfCalls(t.service)},t.startTab()}]),angular.module("personalizerApp").controller("StartCtrl",["$scope",function(e){e.openMain=function(){window.location.href="#/perso"}}]),angular.module("personalizerApp").controller("ZoneCtrl",["$rootScope","$scope","$routeParams","mongoService",function(e,t,a,n){void 0===e.services&&(window.location.href="#/"),t.tab=a.service,t.zone=a.zone,t.service=e.services[t.tab],t.callIDList=[],e.calls=[],t.getCallsOfZone=function(){n.getCallIDZoneSource(t.tab,t.zone).then(function(e){t.callIDList=e,t.getCallsFromCallID(t.callIDList)},function(){window.alert("get callID de la zone"+t.zone+" a échoué")})},t.getCallsFromCallID=function(t){for(var a=function(){n.getCallsCallID(o).then(function(t){e.calls[o]=t},function(){window.alert("suppression appel echoué")})},r=0;t.length>r;r++){var o=t[r];a()}},t.addNewCall=function(e){void 0!==e&&(window.location.href="#/tab/"+t.tab+"/"+t.zone+"/add/"+e)},t.editCall=function(e){void 0!==e&&(window.location.href="#/tab/"+t.tab+"/"+t.zone+"/edit/"+e)},t.removeCall=function(e){void 0!==e&&n.deleteCall(e).then(function(){window.alert(" appel supprimé !"),window.location.href="#/tab/"+t.tab+"/"+t.zone},function(){window.alert("suppression appel echoué")})},t.getOtherZones=function(){for(var e=[],a=0;t.service.length>a;a++){var n=t.service[a];n.zone!==t.zone&&e.push(n.zone)}return e},t.hasOtherZone=function(){return t.getOtherZones().length>0},t.changeZone=function(e){console.log(e),e&&(window.location.href="#/tab/"+t.tab+"/"+e)},t.startZone=function(){e.calls=t.getCallsOfZone()},t.startZone()}]),angular.module("personalizerApp").directive("tabs",function(){return{templateUrl:"views/tabs.html",restrict:"E",controller:["$scope",function(e){e.isActive=function(t){return e.tab?e.tab===t?"active":"":void 0}}]}}),angular.module("personalizerApp").factory("PersoConstants",function(){return{DOMAIN_URL:"http://"+document.location.hostname,PORT:"8080",PATH:document.location.pathname+"rest",PERSO_DOMAIN_URL:"http://"+document.location.hostname,PERSO_PORT:document.location.port,PERSO_PATH:document.location.pathname+"resources",PERSO_FILENAME:"personalizer.json"}}),angular.module("personalizerApp").factory("Manager",["PersoConstants","$http",function(e,t){return{initDB:function(){return t.get(e.DOMAIN_URL+":"+e.PORT+e.PATH).then(function(e){return e.data})},initPersonalizer:function(){return t.get(e.PERSO_DOMAIN_URL+":"+e.PERSO_PORT+e.PERSO_PATH+"/"+e.PERSO_FILENAME).then(function(e){return e.data})}}}]),angular.module("personalizerApp").factory("mongoService",["$http","PersoConstants",function(e,t){return{getCallIDZoneSource:function(a,n){return e.get(t.DOMAIN_URL+":"+t.PORT+t.PATH+"/source/"+a+"/zone/"+n+"/").then(function(e){return e.data})},getCallsCallID:function(a){return e.get(t.DOMAIN_URL+":"+t.PORT+t.PATH+"/call/callID/"+a+"/").then(function(e){return e.data})},getIdentifiedCall:function(a){return e.get(t.DOMAIN_URL+":"+t.PORT+t.PATH+"/call/"+a+"/").then(function(e){return e.data})},addCall:function(a,n){return e.post(t.DOMAIN_URL+":"+t.PORT+t.PATH+"/add/"+a+"/",n).then(function(e){return e.data})},deleteCall:function(a){return e.delete(t.DOMAIN_URL+":"+t.PORT+t.PATH+"/call/delete/"+a+"/").then(function(e){return e.data})},updateCall:function(a,n){return e.post(t.DOMAIN_URL+":"+t.PORT+t.PATH+"/call/edit/"+a+"/",n).then(function(e){return e.data})}}}]);