"use strict";angular.module("personalizerApp",["ngResource"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/tab/:service",{templateUrl:"views/onglet.html",controller:"OngletCtrl"}).when("/tab/:service/:zone",{templateUrl:"views/zone.html",controller:"ZoneCtrl"}).when("/tab/:service/:zone/add/:callID",{templateUrl:"views/add.html",controller:"AddCtrl"}).when("/tab/:service/:zone/edit/:callID",{templateUrl:"views/edit.html",controller:"EditCtrl"}).when("/error",{templateUrl:"views/error.html",controller:"MainCtrl"}).otherwise({redirectTo:"/error"})}]),angular.module("personalizerApp").controller("MainCtrl",["$rootScope","$scope","Manager",function(a,b,c){a.services=[],a.tabs=[],a.dbName=null,b.initPersonalizer=function(){c.initPersonalizer().then(function(b){a.services=b.services,console.log(a.services);for(var c in a.services)a.tabs.push(c);b.dbName&&(a.dbName=b.dbName)},function(){window.alert("initialisation du personalizer failed")})},b.start=function(){b.initPersonalizer()},b.start()}]),angular.module("personalizerApp").controller("OngletCtrl",["$rootScope","$scope","$routeParams",function(a,b,c){void 0===a.services&&(window.location.href="#/"),b.tab=c.service,b.service=a.services[b.tab],b.zones=[],b.numberCalls=0,b.setZone=function(a){window.location.href="#/tab/"+b.tab+"/"+a},b.getZones=function(){for(var a=0;a<b.service.length;a++){var c=b.service[a];b.zones.push(c.zone)}},b.getNumberOfCalls=function(a){for(var b=0,c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.calls.length;e++)d.calls[e].params&&(b+=d.calls[e].params.length);return b},b.startTab=function(){b.getZones(),b.numberCalls=b.getNumberOfCalls(b.service)},b.startTab()}]),angular.module("personalizerApp").controller("StartCtrl",["$scope",function(a){a.openMain=function(){window.location.href="#/perso"}}]),angular.module("personalizerApp").factory("PersoConstants",function(){return{DOMAIN_URL:"http://localhost",PORT:"8080",PATH:"/yourcast-choralies_attente-personalizer/rest",PERSO_DOMAIN_URL:"http://"+document.location.hostname,PERSO_PORT:document.location.port,PERSO_PATH:document.location.pathname+"resources",PERSO_FILENAME:"personalizer.json"}}),angular.module("personalizerApp").factory("mongoService",["$http","PersoConstants",function(a,b){return{getCallIDZoneSource:function(c,d){return a.get(b.DOMAIN_URL+":"+b.PORT+b.PATH+"/scall/source/"+c+"/zone/"+d+"/").then(function(a){return a.data})},getCallsCallID:function(c){return a.get(b.DOMAIN_URL+":"+b.PORT+b.PATH+"/call/callID/"+c+"/").then(function(a){return a.data})},getIdentifiedCall:function(c){return a.get(b.DOMAIN_URL+":"+b.PORT+b.PATH+"/call/"+c+"/").then(function(a){return a.data})},addCall:function(c,d){return a.post(b.DOMAIN_URL+":"+b.PORT+b.PATH+"/call/add/"+c+"/",d).then(function(a){return a.data})},deleteCall:function(c){return a.delete(b.DOMAIN_URL+":"+b.PORT+b.PATH+"/call/delete/"+c+"/").then(function(a){return a.data})},updateCall:function(c,d){return a.post(b.DOMAIN_URL+":"+b.PORT+b.PATH+"/call/edit/"+c+"/",d).then(function(a){return a.data})}}}]),angular.module("personalizerApp").factory("Manager",["PersoConstants","$http",function(a,b){return{initDB:function(){return b.get(a.DOMAIN_URL+":"+a.PORT+a.PATH).then(function(a){return a.data})},initPersonalizer:function(){return b.get(a.PERSO_DOMAIN_URL+":"+a.PERSO_PORT+a.PERSO_PATH+"/"+a.PERSO_FILENAME).then(function(a){return a.data})}}}]),angular.module("personalizerApp").factory("Manager",["PersoConstants","$http",function(a,b){return{initDB:function(){return b.get(a.DOMAIN_URL+":"+a.PORT+a.PATH).then(function(a){return a.data})},initPersonalizer:function(){return b.get(a.PERSO_DOMAIN_URL+":"+a.PERSO_PORT+a.PERSO_PATH+"/"+a.PERSO_FILENAME).then(function(a){return a.data})}}}]),angular.module("personalizerApp").controller("ZoneCtrl",["$rootScope","$scope","$routeParams","mongoService",function(a,b,c,d){void 0===a.services&&(window.location.href="#/"),b.tab=c.service,b.zone=c.zone,b.service=a.services[b.tab],b.callIDList=[],a.calls=[],b.getCallsOfZone=function(){console.log("hello"),d.getCallIDZoneSource(b.tab,b.zone).then(function(a){b.callIDList=a,console.log(a),b.handleCallIDs(a)},function(){window.alert("get callID de la zone "+b.zone+" a échoué")})},b.handleCallIDs=function(b){for(var c=0;c<b.length;c++){var d=b[c];d.callID&&(a.calls[d.callID]=d)}},b.addNewCall=function(a){void 0!==a&&(window.location.href="#/tab/"+b.tab+"/"+b.zone+"/add/"+a)},b.editCall=function(a){void 0!==a&&(window.location.href="#/tab/"+b.tab+"/"+b.zone+"/edit/"+a)},b.removeCall=function(a){void 0!==a&&d.deleteCall(a).then(function(){window.alert(" appel supprimé !"),window.location.href="#/tab/"+b.tab+"/"+b.zone},function(){window.alert("suppression appel echoué")})},b.getOtherZones=function(){for(var a=[],c=0;c<b.service.length;c++){var d=b.service[c];d.zone!==b.zone&&a.push(d.zone)}return a},b.hasOtherZone=function(){return b.getOtherZones().length>0},b.changeZone=function(a){console.log(a),a&&(window.location.href="#/tab/"+b.tab+"/"+a)},b.startZone=function(){b.getCallsOfZone()},b.startZone()}]),angular.module("personalizerApp").directive("tabs",function(){return{templateUrl:"views/tabs.html",restrict:"E",controller:["$scope",function(a){a.isActive=function(b){return a.tab?a.tab===b?"active":"":void 0}}]}}),angular.module("personalizerApp").controller("AddCtrl",["$rootScope","$scope","$routeParams","mongoService",function(a,b,c,d){void 0===a.services&&(window.location.href="#/"),b.tab=c.service,b.zone=c.zone,b.service=a.services[b.tab],b.callID=c.callID,b.parameters={},b.values=[],b.getParams=function(a){for(var c={},d=0;d<b.service.length;d++){var e=b.service[d];if(e.zone===b.zone)for(var f=e.calls,g=0;g<f.length;g++){var h=f[g];h.callID===a&&(c=h)}}return console.log(c),c},b.initValues=function(a){for(var c=[],d=0;d<a.length;d++)c[a[d].id]="";b.values=c},b.getParamProperties=function(a){var c=b.parameters.params,d={};if(c)for(var e=0;e<c.length;e++){var f=c[e];f.id===a&&(d=f)}return d},b.setOption=function(a,c){if(c)for(var d in b.values)d===a&&(b.values[a]=c)},b.validate=function(){console.log(b.values);var a=b.buildCall(b.values);d.addCall(b.callID,a).then(function(){window.alert("appel ajouté"),window.location.href="#/tab/"+b.tab+"/"+b.zone},function(){window.alert("ajout appel echoué")})},b.cancel=function(){var a=window.confirm("Êtes vous sûr de vouloir annuler l'ajout d'un nouveau appel ?");a&&(window.location.href="#/tab/"+b.tab+"/"+b.zone+"/")},b.getPathParams=function(){var a="";if(b.parameters.pathParams){var c=b.parameters.pathParams;if(c.length>0){var d="";b.parameters.pathPrefix&&(d+=b.parameters.pathPrefix);for(var e=0;e<c.length;e++)d+=c[e]+"/";a=d}else b.parameters.pathPrefix&&(a+=b.parameters.pathPrefix)}return a},b.getQueryParams=function(a){var c=[];if(b.parameters.queryParams){var d=b.parameters.queryParams;if(d.length>0)for(var e=0;e<d.length;e++){var f=d[e],g=b.getParamProperties(f);if(a[f]){var h=g.nameInDB,i=a[f];c.push({name:h,value:i})}}}return c},b.getHeaderParams=function(a){var c=[];if(b.parameters.headerParams){var d=b.parameters.headerParams;if(d.length>0)for(var e=0;e<d.length;e++){var f=d[e],g=b.getParamProperties(f);if(a[f]){var h=g.nameInDB,i=a[f];c.push({name:h,value:i})}}}return c},b.buildCall=function(a){var c={path:"",query:{},header:{},method:""};return c.path=b.getPathParams(),b.parameters.method&&(c.method=b.parameters.method),c.query=b.getQueryParams(a),c.header=b.getHeaderParams(a),c},b.startAdd=function(){b.parameters=b.getParams(b.callID),b.initValues(b.parameters.params)},b.startAdd()}]),angular.module("personalizerApp").controller("EditCtrl",["$rootScope","$scope","$routeParams","mongoService",function(a,b,c,d){void 0===a.services&&(window.location.href="#/"),b.tab=c.service,b.zone=c.zone,b.service=a.services[b.tab],b.callID=c.callID,b.params=[],b.values=[],b.getParams=function(a){for(var c=[],d=0;d<b.service.length;d++){var e=b.service[d];if(e.zone===b.zone)for(var f=e.calls,g=0;g<f.length;g++){var h=f[g];h.callID===a&&(c=h.params)}}return c},b.validate=function(){console.log(b.values);var a="";d.updateCall(a,b.values).then(function(){window.alert("appel modifié avec succés"),window.location.href="#/tab/"+b.tab+"/"+b.zone},function(){window.alert("la modification de l'appel a echoué")})},b.cancel=function(){var a=window.confirm("Êtes vous sûr de vouloir annuler la modification de l'appel ?");a&&(window.location.href="#/tab/"+b.tab+"/"+b.zone+"/")},b.initValues=function(a){for(var c=[],d=0;d<a.length;d++)c[a[d].id]=a[d].humanName;b.values=c},b.setOption=function(a,c){if(c)for(var d in b.values)d===a&&(b.values[a]=c)},b.startEdit=function(){b.params=b.getParams(b.callID),b.initValues(b.params)},b.startEdit()}]);